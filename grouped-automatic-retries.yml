steps:
- group: "Group 1"
  steps:
  - command: |
      if [[ -n "$$BUILDKITE_RETRY_COUNT" && "$$BUILDKITE_RETRY_COUNT" -gt 0 ]]; then
        echo "Pass"
        exit 0
      else
        echo "Fail"
        sleep 30
        echo "Manually kill agent"
        sleep 30
      fi
    label: "Fails but eventually passes"
    retry:
      automatic:
      - exit_status: -1
        limit: 1
      - exit_status: 1
        limit: 1
      - exit_status: 255
        limit: 1
      - exit_status: 143
        limit: 1
  - label: "Pass"
    command: "true"

- group: "Group 2"
  steps:
    - label: "Pass"
      command: "true"
    - label: "Pass again"
      command: "true"
